/* jQuery.my 1.1.6
 * Requires jQuery 1.11.0+, SugarJS 1.3.9-1.4.x
 * More details at jquerymy.com */

!function(e){function t(){window.console&&console.error.apply(console,arguments)}function r(){window.console&&console.log.apply(console,arguments)}function n(e,t){return(t||"").split(".").reduce(function(e,t){return null!=e&&null!=e[t]?e[t]:void 0},e)}function a(e,t){var r,i;if(Z(t))return t;if(Y(t)){if(r=n(e,t),null==r&&(r=Object.clone(R._src[t],!0)),null==r&&(r=n(R,t),Z(r)&&Z(r._self)?r=Object.clone(r._self,!0):Z(r)&&(r=Object.clone(r,!0))),null==r&&n(e,"params.cache")&&(i=n(e,"params.cache"),rt(i)?r=i(t):Z(i)&&(r=at(t,i)),Z(r)&&(Z(r._self)&&(r=Object.clone(r._self,!0)),Object.merge(r,{params:{cache:i}},!0))),null!=r&&Z(r))return i=i||n(e,"params.cache"),i&&Object.merge(r,{params:{cache:i}},!0),r;throw"Component "+t+" not found."}return rt(t)?t.apply(e,Array.prototype.slice.call(arguments,2)):null}function o(r,i){var a,o,l,c,u,d=i||R,f=r;if(!(Z(d)&&Z(f)&&Z(f.ui)&&Y(f.id)))return"Can’t save manifest into cache, invalid arguments.";d.hasOwnProperty("_src")||(d._src={}),l=f.id;try{f=Object.clone(r,!0)}catch(m){return"Can’t save circular-referencing object into cache."}try{(!f.params||f.params&&!f.params.strict)&&j(f,!0)}catch(m){return"Invalid manifest, parse error."}if(a=s(f),Y(a))return t(a),a;if(Object.merge(f,{params:{strict:!0}},!0),d._src[l]=f,c=lt.mask(d,l)){if(c.params&&c.params.protect)return"Can’t save manifest into cache over protected one.";c._self&&delete c._self,e.extend(!0,d,lt.unmask("",l))}return e.extend(!0,d,lt.unmask(f,l)),o=Object.keys(d._src).filter(function(e){return e.startsWith(l+".")}),o.sort(),o.forEach(function(t){var r;(r=lt.mask(d,t))&&(r._self&&delete r._self,e.extend(!0,d,lt.unmask("",t))),e.extend(!0,d,lt.unmask(d._src[t],t))}),u=n(d,l),E?u._self=d._src[l]:Object.defineProperty(u,"_self",{get:function(){return d._src[l]},set:function(){throw"Can’t change manifest cache entry directly."},enumerable:!1,configurable:!0}),u}function s(e){var t,r,n=[];if(Z(e.files)&&Object.size(e.files))for(t in e.files){if(r=e.files[t],!Z(r)||!Y(r.data)||r.url)return"Non-object member "+t+" in files section.";if(M)try{lt.base642blob(r.data,function(e){r.blob=e,r.url=M.createObjectURL(r.blob)},r.content_type||r.mime),n.push(t)}catch(i){return"Invalid base64 data in files/"+t+"."}else r.url="data:"+(r.content_type||r.mime)+";base64,"+r.data,n.push(t)}return n}function l(r,n){Z(n)&&n.channel&&n.message&&r.find(".my-listen-"+lt.sdbmCode(n.channel)).each(function(){var r,i=e(this),a=i.data("my"),o=void 0;if(a&&a.ui.listen&&rt(a.ui.listen[n.channel])){r=a.ui.listen[n.channel];try{o=r.call(a.manifest||a.root.my().manifest,a.data,n.message,i)}catch(s){t("Listener failed",s.message,s.stack)}void 0!==o&&(null===o?i.trigger("check"):o&&i.trigger("recalc"))}})}function c(t,r){function i(t,r){var n;return Y(t)?/[\/]/.test(t)?(n=I(!0,{},k,{ref:r,ajax:{url:t}}),K.test(r)&&(n.ajax.dataType="json")):t.length&&(n=I(!0,{},k,{ref:r,ajax:t})):Z(t)&&(n=I(!0,{},k,{ref:r,ajax:e.extend(!0,{},Object.select(t,["accepts","async","cache","data","dataType","xhrFields","password","timeout","type","url","username","headers"]))}),n.ajax.url||(n=null)),n}function a(){g.reject(w)}function o(){O+=1;var e=b[O];if(e)s(e).then(o).fail(a);else{var r=c(x),n=nt(Object.findAll(r,function(e,t){return!t}));n.length&&w.push((1===n.length?"Key "+n[0]+" is":"Keys "+n.join(", ")+" are")+" not present after all."),w.length?a():g.resolve(t)}}function s(r){function n(){c-=1,s?l.reject():.5>c&&l.resolve()}var i,a,o,s=!1,l=e.Deferred(),c=r.length;for(a=0;c>a;a++)i=r[a],o=Y(i.ajax)?j.loader:ot,o(i.ajax).then(function(e,r){K.test(r.ref)&&(null!=e?I(!0,t,lt.unmask(e,r.ref.from(5))):(s=!0,w.push("Invalid data for ‘"+r.ref+"’ resource."))),n()}.fill(void 0,i)).fail(function(e,t){w.push("Failed to load ‘"+t.ref+"’ resource."),s=!0,n()}.fill(void 0,i));return l.promise()}function l(e){var r=!1;return K.test(e)?null!=n(t,e.from(5))&&(r=!0):null!=n(window,e)&&(r=!0),r}function c(e){for(var t in e)e[t]===!1&&(e[t]=l(t));return e}var u,d,f,m,h,p,y,v,g=e.Deferred(),b=[],x={},w=[],j=I(!0,{ajaxTimeout:1e4,loader:st.params.loader},r||{}),k={ref:null,ajax:{type:"GET",async:!0,timeout:j.ajaxTimeout}};if(Z(t))if(X(t.require)){for(m=t.require,u=0;u<m.length;u++)if(h=m[u],Y(h))x[h]=l(h);else if(Z(h)){v=[];for(d in h){if(p=null,h[d]===!0)x[d]=l(d);else if(Y(h[d])||Z(h[d]))p=i(h[d],d);else if(X(h[d])){for(p=[],f=0;f<h[d].length;f++)(Y(h[d][f])||Z(h[d][f]))&&(y=i(h[d][f],d),y&&p.push(y));p.length||(p=null)}p&&!(x[d]=l(d))&&v.add(p)}v.length&&b.push(v)}var O=-1;o()}else g.resolve(t);else g.reject(["Invalid manifest."]);return g.promise()}function u(e,t){var r,n,i=e.data("myval");return i||(n=d(e,st.vals),rt(n)&&(r=n(e,U),void 0===r?e.data("myval",function(e,t){return U!=t&&n(e,t),e.val()}.fill(e,void 0)):e.data("myval",n.fill(e,void 0))),i=e.data("myval")),rt(i)?(r=i(),(r!==t&&(0==t||0==r)||r!=t||Z(t))&&(r=i(t)),r):U}function d(e,t){function r(e,t,o){for(var s in t)if(""!=s&&e.is(s)){a=a+(a?" ### ":"")+s;var l=t[s],c=P(l);if(!/^(nul|un|ob)/.test(c)&&o>i)return n=l,void(i=o);c==H&&r(e,l,o+1)}U!=t[""]&&typeof t[""]!=H&&o>i&&(n=t[""],i=o)}var n=U,i=0,a="";return r(e,t,1),n}function f(e,t,r,n){var i,a,o,s=[],l=r.bind,c=P(l);if(c==W)return l.call(h(n).manifest,e,t,n);if(c===Q||c===B){if(c===Q&&!/\./.test(l))return t!=U?e[l]=t:void 0===e[l]&&(e[l]=U),e[l];for(c===Q&&(s=l.split(".").each(function(e,t){this[t]=e+""})),c===B&&(s=l.slice(0).each(function(e,t){this[t]=e+""})),"this"===s[0]?(a=h(n).manifest,s.shift()):a=e,i=0;i<s.length;i++){if(i===s.length-1)return t!=U?a[s[i]]=t:void 0===a[s[i]]&&(a[s[i]]=U),a[s[i]];0==i?(o=a,a=a[s[0]]):(o=o[s[i-1]],a=a[s[i]]),void 0===a&&(a=o[s[i]]={})}}return U}function m(t,r,n,i){var a,o,s=n.check;if(s!=U){var l=h(i).params.messages,c=n.error,u=c||l.patternMismatch||l[""]||"Error";if(i.size()&&Object.prototype.hasOwnProperty.call(i[0],"validity")&&!i[0].validity.valid){var d=i[0].validationMessage+"";if(""!==d)return d.substr(0,1).toUpperCase()+d.substr(1);o=i[0].validity;for(a in o)""===d&&"valid"!=a&&G(o[a])&&o[a]&&l[a]&&(d=l[a]);return d||c}switch(P(s).to(1)){case"f":return m=s.call(h(i).manifest,t,r,i),null===m||void 0===m?"":m;case"r":return s.test(String(r))?"":u;case"a":return s.indexOf(r)>-1?"":u;case"s":return r==s?"":u;case"o":return s[r]?"":u;case"b":if(i.is(".my-form-list,.ui-sortable")){var f=i.data("listSrc")||i.data("my").listSrc||">*",m={};return i.find(f).filter("*:not(.ui-sortable-placeholder)").each(function(t){var r=e(this);r.data("my")&&!r.my("valid")&&(m[t]=r.my("errors"))}),m}return i.hasClass("my-form")&&s?i.my("valid")?"":i.my("errors"):""}return l.formError||"Error"}return""}function h(e){var t=e.my();return t?t.root?t.root.my():t:null}function p(t,r,n){var i=n.compact(),a=i.replace(/:disabled/g,""),o=a!==i,s="self:"===a.to(5);return s&&(a=a.replace(/^self:/g,"")),r.each(function(){var n=e(this),i=n.my(),l=!s&&i?i.container:n;l.toggleClass(a,!!t),o&&void 0!==i&&!!t!=!!i.disabled&&(n.my().disabled=!!t,i._disable||(n.my()._disable=d(r,st.offon).fill(void 0,r)),i._disable(!!t))}),r}function y(e,r,n){var i,a,o,s,l,c,d,h,v,g,b,x=!1,w=!1,j=e,k=j.my(),O="";if(k){if(h=k.selector,v=k.root,v.hasClass("my-form-init"))return{};if(g=v.find(h),b=v.my().ui,x=e.hasClass("my-form"),w=e.hasClass("my-form-list"),x?(i=e,a=k.ddata,o=k.dui,s=k.dparams):(i=k.container,a=k.data,o=k.ui,s=k.params),o.bind!=U){if(l=F(r)?r:u(g,f(a,U,o,g)),U!=o.check){O="Unknown error";try{O=m(a,l,o,g)}catch(C){t("Error "+C.message+" in .check validator for "+h,v,C.stack)}}var q=s.errorCss,z="ui-state-error";try{U!=r&&(l=u(g,f(a,r,o,g)))}catch(C){O=s.messages.formError||"Error"}if(""===O)x?k.derrors[h]="":k.errors[h]="",i.removeClass(q),i.attr("title")&&i.attr("title",""),x||w||s.effect(i.find(s.errorTip),!1,s.animate/2),j.removeClass(z),j.find(".ui-widget").removeClass(z);else{if(x)k.derrors[h]=O;else if(w)k.errors[h]=O;else{i.addClass(q),k.errors[h]=O;var D=i.find(s.errorTip).eq(0);D.size()?s.effect(D.addClass(q).html(O),!0,s.animate):i.attr("title",(O||"").stripTags())}j.is(".hasDatepicker")&&(j.is("input")?j.addClass(z):j.find(".ui-widget").addClass(z)),j.is(".ui-slider")&&j.addClass(z)}}var _=r==U?l:r;if(o.css)for(c in o.css)d=o.css[c],tt(d)?p(d.test(_),g,c):rt(d)&&p(d.call(v.my().manifest,a,_,g),g,c);var N,S,T=o.recalc,M=[],E={};if(n&&o.recalc&&v.my()){for(b=v.my().ui,N=0;N<T.length;N++)T[N]&&Y(T[N])&&(S=T[N].compact())&&b[S]&&(b[S].recalc?-1===M.indexOf(S)&&M.push(S):E[S]=!0);for(N=0;N<M.length;N++)E=I(!0,E,y(v.find(M[N]),U,n-1));if(r!==U){for(N in E)E[N]===!0&&N!=h&&(b[N].delay&&!b[N].recalc?b[N]._update(v.find(N),U,n-1):y(v.find(N),U,n-1));return{}}}return E||{}}}function v(e,t,r,n){var i,a,o,s,l,c,u,d,f,m=t;if(!Z(m)||isNaN(s=m.remember)||!Z(i=m.history))return U;if(Z(e)&&s){if(c=Object.clone(e,!0),u=Date.now(),o=nt(i).sort(),o.length&&(u-o.last()<m.historyDelay||Object.equal(i[o.last()],c)))return U;if(m.history[u]=c,o.push(u),o.length>=2*s){for(f={},a=s;2*s>a;a++)f[o[a]]=i[o[a]];t.history=f}return n||m.form.trigger(V),m.history[o.last()]}if(!isNaN(e)||e===U){if(l=parseInt(e)||0,0>l)return U;if(o=nt(i).sort(),l>=o.length&&(l=o.length-1),d=Object.clone(m.history[o[o.length-l-1]],!0),r){for(f={},a=0;a<o.length-l-1;a++)f[o[a]]=i[o[a]];t.history=f}return n||m.form.trigger(V),d}return n||m.form.trigger(V),U}function g(i,o,s,l){function c(){var t=null,r=O.manifest;if(rt(r)||Z(r)&&Z(r.ui)?v=r:Y(r)&&(v=a(z,r.replace(K,""))),v&&Y(O.bind)){var o=n(K.test(O.bind)?z:j.data,O.bind.replace(K,""));if(null===C&&(C=e.Deferred()),X(o)||O.list){i.addClass("my-form-list");var s="",c=">*";if(/^<.+>$/.test(O.list)?s=O.list:c=O.list||c,!s){var d=i.find(c);s="<div></div>",d.size()&&(s=e(s).append(d.eq(0).clone(!0)).html(),d.eq(0).remove())}i.data("formlist")||i.data("formlist",{}),i.data("formlist").generator={manifest:v,delay:(O.delay||k.delay||10)/1.3,template:s,selector:c,parent:z,bind:O.bind,hash:rt(O.hash)?O.hash.bind(z):f(O.hash),id:rt(O.id)?O.id.bind(z):f(O.id),ext:!(!O.id&&!O.hash),stamp:0},i.on("insert.my",function(t,r){t.stopPropagation();var n={what:void 0,where:0};null==r?n.where=1e6:Z(r)?Object.merge(n,r):(Y(r)||et(r))&&(n.where=r),e(t.target).my("insert",n.where,n.what)}),i.on("remove.my",function(t){t.stopPropagation(),e(t.target).my("remove")})}else try{t=i.my(a(z,v),Z(o)?o:void 0)}catch(h){u("$.my subform init of "+l+" failed: "+h.message,h.stack)}}it(t)?t.then(m,function(e,t){u("Init of subform "+l+" failed with error: "+e,t)}):m()}function u(e,r){t(e,r),C&&C.reject(e,r)}function f(e){var t=P(e).to(3);return e?"str"===t?n.fill(void 0,e):"arr"===t?lt.mask.fill(void 0,e):null:null}function m(){i.each(function(){var t,r,n=e(this),a=!1,c=n[0].nextSibling;if(r=c&&c.CodeMirror?c.CodeMirror:null,r&&n.addClass("my-codemirror"),t=O.events||d(n,st.events),n.is(".my-form")?I(n.data("my"),{dui:O,root:o,selector:l,dparams:k,devents:t,ddata:j.data,container:k.container(n),derrors:j.errors}):(n.data("my",{events:t,selector:l,initial:p,previous:p,root:o,container:k.container(n),id:j.id,ui:O,data:j.data,params:k,errors:j.errors}),s._update=O.delay?y.debounce(O.delay):U,a=!0),a)if(n.cleditor&&n.parent().is(".cleditorMain")){var u=n.cleditor()[0];if(u&&u.$frame&&u.$frame[0]){n.addClass("my-cleditor"),I(n.data("my"),{container:k.container(n)});var f,m=function(e){n.val(e).trigger(V)},h=Number.random(1e5,1e6-1);e(u.$frame[0]).attr("id","cleditCool"+h),f=document.frames?document.frames["cleditCool"+h].document:e("#cleditCool"+h)[0].contentWindow.document;var v=e(f).find("body");e(f).bind("keyup.my",function(){m(e(this).find("body").html())}),n.parent().find("div.cleditorToolbar").bind("click.my mouseup.my",function(){m(v.html())}),e("body").on("click","div.cleditorPopup",function(){m(v.html())})}}else if(n.is("div.redactor_box textarea")){var w,C="my-redactor-9";try{w=n.getEditor(),C="my-redactor-8"}catch(q){w=n.redactor("getEditor")}w&&(n.addClass(C),w.bind("input.my keyup.my blur.my",function(e){e.trigger("redactor")}.fill(n)))}else n.is(".ace_editor")?ace.edit(i[0]).on(V,function(e){e.trigger("ace")}.fill(n)):r&&r.on(V,function(e){e.trigger("codemirror")}.fill(n));n.my()._changed=b.debounce(g),n.my()._recalc=x.debounce(g),n.bind(t,function(e){e.type==V&&e.stopPropagation(),a&&(j.locktill=Date.now()+s.delay),n.my()._changed(n,o,s,k)}),/check(\.my)?/.test(t+"")||n.on("check.my",function(){return n.my()._changed(n,o,s,k,!0),!1}),n.on("recalc.my, redraw.my",function(e){e.stopPropagation(),n.my()._recalc(n,o,s,k)})}),C&&C.resolve()}var h,p,v,g,j=o.my(),k=(j||{}).params,O=s,C=null,q=0,z=j.manifest;return j?(g=s.delay,i.size()?(O.init!=U&&(h=w(z,O.init,i,j)),it(h)?(q+=1,C=e.Deferred(),h.then(c,function(e,t){u("Init of "+l+" failed: "+e,t)})):c()):r("Not found "+l+" selector.",o),C):(t("Failed to find $root building "+l+" selector."),null)}function b(e,t,r,n,i){var a=e.data("my"),o=t.data("my");if(a&&!a.disabled){v(a.ddata||a.data,a.dparams||a.params);var s=t.find(a.selector);y(e,i?U:u(s,U),r.recalcDepth||n.recalcDepth),void 0===o.orphan&&a.root.parent().hasClass("ui-sortable")&&(o.orphan=!a.root.parent().hasClass("my-form-list")),o.orphan&&a.root.parent().trigger("check"),n.change&&n.change.call(e)}}function x(e,t,r,i){var a=e.my();if(a&&!a.disabled){var o=t.find(a.selector);o.is(".my-form")?o.my("redraw"):y(e,o.is(".my-form-list")?n(o.my().data,o.data("formlist").generator.bind):U,r.recalcDepth||i.recalcDepth)}}function w(e,t,r,i){var a;if(Y(t)){if(a=n(e,t),void 0===a)return r.html(t.assign(i.data)),null}else a=t;if(rt(a))return a.apply(e,Array.prototype.slice.call(arguments,2));if(X(a))try{r.formgen(a)}catch(o){}return null}function j(e,t){var r,n=!t;for(r in e)e.hasOwnProperty(r)&&k(r,e,n)}function k(e,r,n){var i,a,o,s="";(n||!/^(data|files|require)$/.test(e))&&(i=r[e],s=P(i),/^(ob|ar)/.test(s)?j(i):"string"===s&&/^(function\s*\(|new\sRegExp)/.test(i)&&((a=i.match(/^function\s*\(([^\)]*)\)\s*\{([\s\S]*)\}[\s\n\r\t]*$/))&&3===a.length?(o=O(a[1],a[2]),"function"==typeof o?r[e]=o:t("Invalid function in XJSON, skipped",o.message,o.stack,i)):(a=i.match(/^new\sRegExp\s*\(\/([\s\S]+)\/([a-z]*)\)$/))&&3===a.length&&(o=C(a[1],a[2]),"function"==typeof o.test?r[e]=o:t("Invalid RegExp in XJSON, skipped",o.message,o.stack,i))))}function O(e,t){var r;try{r=new Function(e,t)}catch(n){r={message:n.message,stack:n.stack}}return r}function C(e,t){var r;try{r=new RegExp(e,t)}catch(n){r={message:n.message,stack:n.stack}}return r}function q(e,t,r){var i=Z(t)?t:null;return Object.each(e,function(t,r){var n=typeof r;/^str|^fu/.test(n)&&(e[t]={bind:r})}),Object.each(e,function(t,a){var o,s,l,c=[],u=[],d=/\s?[,;]\s?/;a.recalc&&(Y(a.recalc)?c=a.recalc.split(d):X(a.recalc)&&(c=a.recalc),c=c.compact(!0).unique()),c.length&&(e[t].recalc=c),null==a.bind&&(a.bind=function(){});var f;if(a.listen&&(f=z(a.listen),a.listen=Object.size(f)?f:void 0),a.hasOwnProperty("watch"))for(Y(a.watch)?u=a.watch.split(d):X(a.watch)&&(u=a.watch.slice(0)),u=u.compact(!0).unique(),l=0;l<u.length;l++)(o=e[u[l]])&&(s=o.recalc,s?Y(s)?o.recalc+=","+t:X(s)&&-1==s.indexOf(t)&&o.recalc.push(t):o.recalc=[t]);null!==i&&["css","check","manifest","list","hash","id"].each(function(e){if(Y(a[e])){var t=n(i,a[e].replace(K,""));null!=t&&(a[e]=t)}}),a.delay=isNaN(a.delay)?r.delay:a.delay-0}),e}function z(e){var t,r={},n=function(){return null};if(Y(e))e.split(/[,\s]+/).compact(!0).unique().map(function(e){r[e]=n});else if(X(e))e.compact(!0).unique().map(function(e){r[e]=n});else if(Z(e))for(t in e)r[t]=rt(e[t])?e[t]:function(){return e[t]};return r}function D(e){var t=e,r={};if(Y(t)&&(t=t.split(/[,\s]+/)),X(t)){for(t=t.compact(!0),i=0;i<t.length;i++)r[t[i]]=!0;return r}return Z(t)?e:null}function _(e,t){function r(i,a,o,s){var l,c,u,d,f=i;if(Y(f)&&(/[\r\n]/.test(f)||f.split("}",3).length>2?f=lt.css2json(f):o.push(a+(/\{/.test(f)?f:"{"+f+"}"))),X(f)&&f.length)for(l=0;l<f.length;l++)r(f[l],a,o,s);else if(Z(f))for(l in f)for(d=n(a,l),c=0;c<d.length;c++)r(f[l],d[c],o,s);else if(rt(f))try{u=f.call(t,e,t),r(u,a,s,s)}catch(m){}}function n(e,t){var r,n="",i=t+"";return(" "===i.to(1)||/^[a-z]/i.test(i))&&(n=" "),r=i.split(/\s*,\s*/).compact(!0),r.length||r.push(""),r.map(function(t){return e+n+t})}var i=[],a=[],o=t;return Z(o)&&Z(o.style)?(r(t.style,"",i,a),[i,a]):""}function N(){return{con:r,clone:function(e){return e.clone?e.clone():e},extval:function(e){var t=e.my();return t&&t.data?t.data:e.data("value")||e.val()||e.text()||e.html()||""},jquix:function(e,t,r){return e[t](r?"disable":"enable")},overlap:function(){function e(e,t,r){return void 0===r||null===r?t:Z(r)?Object.merge(t,r,!1):r}if(!arguments.length)return{};if(1===arguments.length)return arguments[0];for(var t=1;t<arguments.length;t++)Object.merge(arguments[0],arguments[t],!1,e);return arguments[0]},patch:function t(e,r){for(var n in r)r.hasOwnProperty(n)&&(Z(r[n])?e.hasOwnProperty(n)?t(e[n],r[n]):e[n]=Object.clone(r[n],!0):e.hasOwnProperty(n)||(e[n]=X(r[n])?r[n].clone(!0):r[n]));return e},kickoff:function(e,t){var r,n=t&&"object"==typeof t?Object.clone(t,!0):{};for(r in e)e.hasOwnProperty(r)&&(delete e[r],void 0!==n[r]&&(e[r]=n[r]))},sdbmCode:function(e){for(var t=JSON.stringify(e),r=0,n=0;n<t.length;n++)r=t.charCodeAt(n)+(r<<6)+(r<<16)-r;return(1e11+r).toString(36)},tojson:function(){function e(e){return 10>e?"0"+e:e}function t(e,i,a){var o,s,l,c,u=0,d=i||0,f=r;switch(a&&Y(a)&&(u=String(a).length,f=String(a).repeat(10)),(typeof e).substr(0,3)){case"str":return n(e);case"num":return isFinite(e)?""+String(e):"null";case"boo":case"nul":return String(e);case"fun":return n(e.toString().replace(/^(function)([^\(]*)(\([^\)]*)([\n\t][^)]*)(\).*)/,"$1 $3$5").replace(/(})([^}]*$)/,"$1"));case"obj":if(!e)return"null";if(typeof e.toJSON===W)return t(e.toJSON(),d+(a?1:0),a);if(o=[],X(e)){for(s=0;s<e.length;s+=1)o.push(t(e[s],d+(a?1:0),a)||"null");return"["+o.join(","+(a?"\n"+f.to(d*u+u):""))+"]"}for(l in e)Y(l)&&(c=t(e[l],d+(a?1:0),a),c&&o.push((a?"\n"+f.to(d*u+u):"")+t(l,d+(a?1:0),a)+": "+c));return"{"+o.join(",")+(a?"\n"+f.to(d*u):"")+"}"}}Date.prototype.toJSON=function(){var t=this;return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"},RegExp.prototype.toJSON=function(){return"new RegExp("+this.toString()+")"};var r="	".repeat(10),n=JSON.stringify;return t.fill(void 0,0,void 0)}(),fromjson:function(e){var t=JSON.parse(e);return j(t),t},mask:function(e,t){function r(e,t){if(!Z(t))return{};var n={};for(var i in t)!Z(t[i])&&e.hasOwnProperty(i)?n[i]=Object.clone(e[i],!0):e.hasOwnProperty(i)&&(n[i]=Z(e[i])?r(e[i],t[i]):Object.clone(e[i],!0));return n}if(!Z(e))return null;var i,a=t;if(Y(a))return n(e,a);if(X(a)){i=[];for(var o=0;o<a.length;o++)i[o]=Y(a[o])?n(e,a[o])||null:null;return i}return Z(a)?r(e,a):void 0},unmask:function(e,t){function r(e,t,r){var n,i,a,o=Object.clone(t,!0),s=0;if(/\./.test(r))for(i=r.split(".").each(function(e,t){this[t]=String(e).compact()}),n=e;s<i.length;s++)s===i.length-1&&(n[i[s]]=o),0===s?(n=e[i[0]],a=e):(a=a[i[s-1]],n=n[i[s]]),void 0===n&&(n=a[i[s]]={});else null!=t&&(e[r]=o);return e}var n={};if(Z(e)&&Z(t))return lt.mask(e,t);if(X(e)&&X(t)){for(var i=0;i<t.length;i++)null!=e[i]&&r(n,e[i],t[i]);return n}return Y(t)?r({},e,t):null},getref:n,require:c,repo:function(){return R},restyles:function(){return $},unjson:function(e){return j(e),e},blob2base64:function(e,t,r){var n=new FileReader;n.onload=function(){t(r?n.result:n.result.split(",")[1])},n.readAsDataURL(e)},base642blob:function(e,t,r){for(var n,i=atob(e),a=i.length,o=new ArrayBuffer(a),s=new Uint8Array(o),l=0;a>l;l++)s[l]=i.charCodeAt(l);return n=new Blob([s],{type:r||"application/octet-stream"}),rt(t)?void t(n):n},base64:function(t,r,n){var i=(P(t),null),a=Y(t)?t:e.my.tojson(t),o=Y(n)?"data:"+n+";base64,":"";if(r){try{i=decodeURIComponent(escape(window.atob(a)))}catch(s){i=null}if(null!==i&&/(^".*"$)|(^\[.*\]$)|(^\{.*\}$)/.test(i))try{i=e.my.fromjson(i)}catch(s){i=null}return i}return o+window.btoa((n===!0?"ï»¿":"")+unescape(encodeURIComponent(a)))},css2json:function(e){var t=(e+"").replace(/\/\*[\s\S]+\*\//gm,"").replace(/@charset[^;]+;/gim,"").replace(/[\n\t\s]+/g," ").replace(/\}/g,"}ᴥ").replace(/^\n+/g,"").replace(/[\n\s]+$/g,"").split("ᴥ").compact(!0).reduce(function(e,t){var r,n,i,a=t.trim();return/^[^{]+\{[^\}]+\}$/.test(a)&&(r=a.to(-1).split("{"),n=" "+r[0].trim(),i=r[1].trim(),";"!=i.last()&&(i+=";"),e[n]||(e[n]=""),e[n]+=i),e},{});return t}}}var S,T="jQuery.my 1.1.6",M=window.URL||window.webkitURL,E=!document.addEventListener,R=n(e,"my.f.repo")?e.my.f.repo():{_src:{},_name:"Default manifest cache"},$=n(e,"my.f.restyles")?e.my.f.restyles():{},I=e.extend,P=e.type,U=null,F=function(e){return null!==e&&void 0!==e},L="{yyyy}-{MM}-{dd}",A="{HH}:{mm}",H="object",J="data",B="array",Q="string",W="function",V="change",K=/^this\./,X=Object.isArray,G=Object.isBoolean,Y=Object.isString,Z=Object.isObject,et=Object.isNumber,tt=Object.isRegExp,rt=Object.isFunction,nt=Object.keys,it=function(e){return!!(null!=e&&(Z(e)||e.jquery)&&rt(e.then)&&rt(e.fail)&&rt(e.state))},at=function(e,t){var r,i;return Y(e)?(r=e,i=n(Z(t)?t:R,r),"exist"===t?Z(i):i?Object.clone(i,!0):null):Z(e)?(i=o(e,t),Z(i)?i:null):void 0===e?R._src:null===e?Object.reject(R,/^_/):null},ot=e.ajax,st={vals:{".my-form":function(e,t){if(e&&e.my){var r=e.my(J);return Object.equal(r,t)?r:e.my(J,t,!0)}return t||U},".hasDatepicker":function(e,t){F(t)&&e.datepicker("setDate",""==t?t:Date.create(t));var r=e.datepicker("getDate");return r?r.format(L):""},".my-tags":function(e,t){return F(t)&&(Y(t)||et(t)?e.tags(J,[t+""]):X(t)&&e.tags(J,t)),e.tags(J)},".ui-draggable":function(e,t){if(F(t)&&Z(t)){var r={};isNaN(t.left)||(r.left=Number(t.left).ceil(2)+"px"),isNaN(t.top)||(r.top=Number(t.top).ceil(2)+"px"),(r.left||r.top)&&e.css(r)}var n=e.position();return{left:t&&!isNaN(t.left)?(1*t.left).ceil(2):n.left.ceil(2),top:t&&!isNaN(t.top)?(1*t.top).ceil(2):n.top.ceil(2)}},".my-form-list":function(t,r){function n(){var r,n,i=e(this),a=i.data("my");a&&(r=i.data("formlist"),n=r.index,r.hash=b(a.data,n)+"",r.oid=x!==b?x(a.data,n)+"":r.hash),t.trigger("check.my")}function i(e){e.data("my").locktill+j/1.3<z&&e.my("redraw")}var o,s,l,c,u,d,f="ui-sortable",m="."+f+"-placeholder",h=t.data("formlist")||{},p=h.generator||{},y=p.selector||">.my-form",v=p.template||"<div></div>",g=/\{/.test(v),b=p.hash||lt.sdbmCode,x=p.id||lt.sdbmCode,w=p.ext,j=p.delay||50,k=t.is("."+f),O=!!t.children(m).size(),C=[],q=[],z=Date.now(),D=t.find(k?t.sortable("option","items"):y);if(F(r)&&X(r)){if(O)return r;if(s=[],D.each(function(){var t=e(this),r=t.data("my");r&&s.push(r.data)}),c=!1,s.length===r.length)for(c=!0,o=0;o<s.length;o++)s[o]!==r[o]&&(c=!1);if((!c||w)&&(l=e.extend(!0,[],s,r),!Object.equal(s,l)||l.length!=r.length)){var _=[],N=[],S={},T={};for(q=[],o=0;o<r.length;o++)N[o]=x(r[o],o)+"",S[N[o]]=o,_[o]=(x!==b?b(r[o],o):N[o])+"";for(D.each(function(){var t=e(this),r=t.data("formlist")||{},n=r.oid;n&&S.hasOwnProperty(n)?T[n]=e(this):t.is(".my-form")?t.my("remove",!0):t.remove()}),o=0;o<r.length;o++)T[N[o]]?(u=T[N[o]].detach().appendTo(t),C.push(u.my("data")),_[o]!==(u.data("formlist")||{}).hash&&q.push(u)):(u=e(g?v.assign(r[o]):v).appendTo(t),u.data("formlist",{list:r[o],index:o,hash:_[o],oid:N[o]}),u.my(a(p.parent,p.manifest,r[o],o,r,t),r[o]).then(function(e){e.on("change.my",n.debounce(j/1.3))}.fill(u)),C.push(u.my("data")));if(q.length&&w){for(o=0;o<q.length;o++)i(q[o]);q=[]}return C}return s}if(D.size()){if(z-p.stamp>1.4*j||z-p.stamp>100||!p.stashed||p.stashed.length!==D.size()-(O?1:0)){O&&(d=t.find(">."+f+"-helper"));var M=0;for(D.each(function(t,r){var n,i,a,o=e(r),s=!1;O&&o.hasClass(f+"-helper")||(O&&o.hasClass(f+"-placeholder")&&(o=d),n=o.data("my"),i=o.data("formlist"),n&&i&&(C.push(n.data),M!=i.index&&(i.index=M,s=!0),w&&(a=b(n.data,M)+"",a!==i.hash&&(i.hash=a,s=!0)),M+=1,s&&q.push(o)))}),o=0;o<q.length;o++)i(q[o]);q=[],p.stamp=z,p.stashed=C}else C=p.stashed.slice(0);return C}return r||[]},".ui-sortable":function(t,r){var n,i=[],a="ui-sortable",o=">."+a+"-placeholder",s=t.find(t.sortable("option","items"));if(F(r)&&X(r)){var l={},c={},u=r.unique();if(t.find("input:focus:eq(0),textarea:focus:eq(0)").size()||t.find(o).size())return u;s.each(function(){l[lt.sdbmCode(lt.extval(e(this)))]=e(this)});for(var d=u.length-1;d>=0;d--){var f=lt.sdbmCode(u[d]);l[f]&&(l[f].prependTo(t).show(),c[f]=!0,-1==i.indexOf(u[d])&&i.push(u[d]))}i=i.reverse();for(d in l)c[d]||l[d].hide()}else{var m=t.find(o),h=t.eq(0);0!=m.size()?(h.my()[a]!=m.position().left+""+m.position().top?(s=s.filter(":visible:not(:disabled, .ui-state-disabled, .ui-sortable-helper)"),n=t.find(t.sortable("option","items")).filter(".ui-sortable-helper"),s.each(function(){var t=e(this);i.push(lt.extval(t.is(".ui-sortable-placeholder")?n:t))}),h.my()[a]=m.position().left+""+m.position().top,h.my()[a+"1"]=i):i=h.my()[a+"1"],i==U&&s.each(function(){i.push(lt.extval(e(this)))})):(s=t.find(t.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled)"),s.each(function(){i.push(lt.extval(e(this)))}))}return i},"input[type=date]":function(e,t){if(F(t))return r=""!=t?Date.create(t).format(L):"",Y(r)&&!/Invalid/.test(r)&&e.val(r),r;var r=e.val();return""!=r?Date.create(r).format(L):""},"input[type=time]":function(e,t){if(F(t))return r=""!=t?Date.create(t).format(A):"",Y(r)&&!/Invalid/.test(r)&&e.val(r),r;var r=e.val();return""!=r?Date.create(r).format(A):""},input:{"[type='text'],[type='number'],[type='search'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(e,t){F(t)&&e.val(t).slider("refresh")},".tagstrip input.value":function(e,t){F(t)&&e.val(t).trigger("update")},"div.select2-container+input":function(e,t){return F(t)&&JSON.stringify(t)!==JSON.stringify(e.select2("val"))&&e.select2("val",X(t)?t:[t]),e.select2("val")},"":function(e,t){F(t)&&e.val(t+"")}},":radio":function(t,r){var n=-1;if(F(r)){t.each(function(t){var i=e(this).val();r+""==i+""&&(n=t)});var i=t.eq(0).checkboxradio;if(i&&t.each(function(t){var r=e(this);n!=t&&r.is(":checked")&&r.prop("checked",!1).checkboxradio("refresh")}),n>-1){var a=t.eq(n);a.is(":checked")||(a.prop("checked",!0),i&&a.checkboxradio("refresh"))}else i||t.each(function(){e(this).prop("checked",!1)})}if(-1==n)for(var o=0;o<t.size();o++)t.eq(o).is(":checked")&&(n=o);return-1!=n?t.eq(n).val():""},":checkbox":function(t,r){var n=r,i=[];if(F(n)){X(n)||(n=[r]);var a=!!t.eq(0).checkboxradio;t.each(function(){var t=e(this),r=t.val(),o=t.is(":checked");-1!=n.indexOf(r)?(i.push(r),o||t.prop("checked",!0)):o&&t.prop("checked",!1),a&&t.checkboxradio("refresh")})}else t.each(function(){var t=e(this);t.is(":checked")&&i.push(t.val())});return i}},select:{".ui-slider-switch":function(e,t){F(t)&&(e.val(t+""),e.slider("refresh"))},"div.select2-container+select":{"[multiple]":function(e,t){return F(t)&&e.select2("val",X(t)?t:[t]),e.select2("val")},"":function(e,t){return F(t)&&e.select2("val",t+""),e.select2("val")}},"[multiple]":function(e,t){F(t)&&(e.val(t,[]),e.selectmenu&&(e.data("uiSelectmenu")||e.data("selectmenu"))&&e.selectmenu("refresh",!0))},"":function(e,t){F(t)&&(e.val(t+""),e.selectmenu&&(e.data("uiSelectmenu")||e.data("selectmenu"))&&e.selectmenu("refresh",!0))}},textarea:{".my-cleditor":function(e,t){return F(t)&&e.val(t).cleditor()[0].updateFrame(),e.val()},"div.redactor_box textarea,.redactor":function(e,t){var r=e.hasClass("my-redactor-9");return F(t)?(r?e.redactor("set",t):e.setCode(t,!1),t):r?e.redactor("get"):e.getCode()},".my-codemirror":function(e,t){return F(t)?(e[0].nextSibling.CodeMirror.setValue(t),t):e[0].nextSibling.CodeMirror.getValue()},"":function(e,t){F(t)&&e.val(t+"")}},"fieldset,form,section,footer,aside,.my-container":function(e,t){var r=Array.prototype.slice.call(e[0],0).sort(),n=t;return F(t)&&(Y(t)&&(n=t.split(/[,\s]+/).compact(!0)),X(n)&&(n.sort(),n.join(" ")!==r.join(" ")&&(e.atrr("css",n.join(" ")),r=n))),r},"div,span,a,p,li,td,th,h1,h2,h3,h4,h5,h6":{".ui-slider":function(e,t){return F(t)&&e.slider("option",e.slider("option","values")?"values":"value",lt.clone(t)),lt.clone(e.slider("option","values")||e.slider("option","value")||0)},".ui-buttonset":function(t,r){if(F(r)){if(""!=r){var n=U;if(t.find(":radio").each(function(){n=(e(this).val()||e(this).button("option","label"))==r?e(this):n}),n)return n.attr("checked",!0),t.buttonset("refresh"),r}}else{var i=t.find(":radio:checked");if(i.size()&&i.button)return i.val()||i.button("option","label")}return t.find(":radio:checked").attr("checked",!1),t.buttonset("refresh"),""},".ace_editor":function(e,t){return F(t)&&ace.edit(e[0]).setValue(t),ace.edit(e[0]).getValue(t)},"":function(e,t){return F(t)&&e.html(t),e.html()}},"pre,code":function(e,t){return F(t)&&e.html(t),e.html()},img:function(e,t){return F(t)&&e.attr("src",t),e.attr("src")||""},"":function(e,t){return F(t)&&e.html(t),e.html()||e.text()||String(e.val())||""}},msg:{"":{en:"Invalid input",ru:S="Неверное значение"},formError:{en:"Form error",ru:"Ошибка формы"},initFailed:{en:'<p class="my-error">Form init failed</p>',ru:'<p class="my-error">Ошибка инициализации формы</p>'},badInput:{en:"Invalid input",ru:S},patternMismatch:{en:"Pattern mismatch",ru:"Не соответствует шаблону"},rangeOverflow:{en:"Over maximum",ru:"Больше максимума"},rangeUnderflow:{en:"Under minimum",ru:"Меньше минимума"},stepMismatch:{en:"Step mismatch",ru:"Не кратно шагу"},tooLong:{en:"Too long",ru:"Слишком длинно"},typeMismatch:{en:"Invalid type",ru:"Неверный тип"},valueMissing:{en:"Required",ru:"Обязательное поле"}},events:{".hasDatepicker":"change.my check.my",".my-form,.my-tags":"change.my check.my",".ui-slider":"slide.my check.my","div.redactor_box textarea":"redactor.my check.my",".my-codemirror":"codemirror.my check.my",".ace_editor":"ace.my check.my",".my-form-list":"sortupdate.my check.my",".ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","a, .pseudolink, input[type=button], button":"click.my","img, :radio, :checkbox":"click.my check.my","div.select2-container+input,div.select2-container+select":"change.my check.my input.my",".ui-buttonset,input, select, textarea":"blur.my change.my check.my"+("Micro"===navigator.appName.to(5)?" keyup.my":" input.my"),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input,textarea,select,button,:radio":function(e){return e.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(e){return e.parents(".tagstrip").eq(0)},"div.redactor_box textarea":function(e){return e.parents("div.redactor_box").eq(0).parent()},".my-tags,.hasDatepicker,.ui-widget,input,textarea,select,button":{".my-cleditor":function(e){return e.parents("div.cleditorMain").eq(0).parent()},"":function(t){var r=t[0].parentNode,n=r.nodeName;return/^(div|span|a|p|form|fieldset|li|ul|td|th|h\d)$/i.test(n)?e(r):t.parents("div,span,a,p,form,fieldset,li,ul,td,th,h1,h2,h3,h4,h5,h6").eq(0)}},"":function(e){return e}},offon:{".ace_editor":function(e,t){ace.edit(t[0]).setReadOnly(e)},".ui-selectable":function(e,t){lt.jquix(t,"selectable",e)},".ui-slider":function(e,t){lt.jquix(t,"slider",e)},".ui-draggable":function(e,t){lt.jquix(t,"draggable",e)},".ui-buttonset":function(e,t){lt.jquix(t,"buttonset",e)},".hasDatepicker":function(e,t){lt.jquix(t,"datepicker",e)},".my-form":function(e,t){t.my("disabled",!!e)},"div.select2-container+input,div.select2-container+select":function(e,t){lt.jquix(t,"select2",e)},".my-cleditor":function(e,t){t.cleditor()[0].disable(!!e)},"":function(e,t){t.attr("disabled",!!e)}},destroy:{".hasDatepicker":function(e){e.datepicker("destroy")},".ui-slider":function(e){e.slider("destroy")},".ui-sortable":{".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")}),t.removeClass("my-form-list"),t.sortable("destroy")},"":function(e){e.sortable("destroy")}},".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")})},".ui-draggable":function(e){e.draggable("destroy")},".my-redactor-8":function(e){e.destroyEditor(),e.removeClass("my-redactor-8")},"div.select2-container+input,div.select2-container+select":function(e){e.select2("destroy")
},".my-form":function(e){e.my("remove")},textarea:{".my-codemirror":function(e){e[0].nextSibling.CodeMirror.toTextArea(),e.removeClass("my-codemirror")}}}};st.params={container:function(e){return d(e,st.containers)(e)},change:U,recalcDepth:2,delay:0,strict:!1,restyle:-1,locale:S=(navigator.language||navigator.userLanguage||"en").substr(0,2),messages:Object.map(st.msg,function(e,t){return t[S]||t.en}),errorTip:".my-error-tip",errorCss:"my-error",animate:0,effect:function(e,t,r){return t?e.fadeIn(r):void e.fadeOut(r)},remember:0,silent:!1,history:{},historyDelay:100,loader:function(t){var r=e.Deferred(),n=at(t+"");return n?r.resolve(n):r.reject(null),r.promise()},ajaxTimeout:1e4};var lt=N(),ct={init:function(i,a,o){function c(e){var t,r,i,a,o,s,l={},c=!0,u=e.inherit;if(l=D(u),!Object.size(l))return null;if(a=dt.parents(".my-form").eq(0),!a.size())return null;if(o=a.data("my"),!o||!o.manifest)return null;i=o.manifest,r=i.expose,c=!r;for(t in l)(c||r[t])&&(s=n(i,t),null!=s&&(/\./.test(t)||Y(l[t])?I(!0,P,lt.unmask(s,Y(l[t])?l[t]:t)):e[t]=s))}function d(){var e,r;for(var e in G)for(r in E[e].listen)G[e].addClass("my-listen-"+lt.sdbmCode(r));V.radio&&dt.on("radio.my",function(e,r){var n,i;if(Z(r)&&r.channel&&r.message&&rt(V.radio[r.channel])){n=V.radio[r.channel];try{i=n.call(V,e,r)}catch(a){t("Radio handler for form "+S+"failed",a.message,a.stack)}void 0!==i&&(e.stopPropagation(),i&&l(dt,r))}})}function m(){R.strict||j(P,!0),V=I(!0,V,Object.reject(P,["data"])),E=q(I(!0,{},P.ui||{}),V,R),V.radio&&(V.radio=z(V.radio)),V.expose&&(V.expose=D(V.expose)),N=Number.random(268435456,4294967295).toString(16),C=P.id||"my"+N,S=lt.sdbmCode(C),V.id=C,R.form=dt,P.params&&P.params.depth&&(R.recalcDepth=P.params.depth);for(F in V)rt(V[F])&&(V[F]=V[F].bind(V));P.error&&(Y(P.error)?nt=function(e,t){return P.error.assign(I({message:e+"",err:t+""},P))}:rt(P.error)&&(nt=function(e,t){T=null;try{T=P.error(e,t)}catch(r){T=R.messages.initFailed}return T})),I(dt.data("my"),{id:C,cid:N,mid:S,errors:Object.extended(),ui:Object.extended(E),disabled:!1,manifest:V,locFiles:[],modals:{},radio:{}}),dt.addClass("my-form"),A="my-manifest-"+S,H="my-form-"+N,dt.addClass(H+" "+A)}function h(t){function r(e,t){return'<style id="'+t+'" data-count="0">.'+t+e.join(" \n."+t)+"\n</style>"}V.style&&(L=_(dt,V,A,H),L&&L[0].length&&!t&&(B=e("style#"+A),B.size()||(B=e(r(L[0],A)).appendTo(e("body"))),B.data("count",1*B.data("count")+1),dt.data("my").style=B),L&&L[1].length&&(Q=e("style#"+H),Q.size()?t&&(e(r(L[1],H)).replaceAll(Q),Q=e("style#"+H)):(Q=e(r(L[1],H)).appendTo(e("body")),R.restyle>-1&&!$[N]&&($[N]=function(){h(!0)}.debounce(R.restyle)),dt.data("my").restyle=h.fill(!0).debounce(0)),dt.data("my").localStyle=Q))}function p(){var t,r,n=e.Deferred();if(r=s(V),Y(r))x("Error decoding base64 to local Blob/URL",r),n.reject();else{if(M)for(t=0;t<r.length;t++)X.push(V.files[r[t]].url);X.length&&(dt.data("my").locFiles=X),n.resolve()}return n.promise()}function y(){if(P.init!=U){ut=dt.find(">*").clone();try{W=w(V,P.init,dt,P)}catch(t){return x(Y(t)?t:t.message,t.stack),dt}}if(it(W)?W.then(function(){v()},function(e,t){x(e,t)}):v(),!tt){if(!dt.my())return x("Internal error initializing controls",""),dt;dt.data("my").initial=I(!0,{},K),e.mobile&&e.mobile.changePage(e.mobile.activePage)}}function v(){function e(e){tt||(t[e]=u(dt.find(e),U),r-=1,.5>r&&b(t))}var t={},r=Object.size(E);dt.addClass(ot),Object.each(E,function(t){if(!tt){var r=dt.find(t),n=g(r,dt,E[t],t);it(n)?n.then(e.fill(t)).fail(function(e,r){x("Error building "+t+", "+e,r)}):tt||e(t)}})}function b(e){var r,n,i;for(var a in E){if(tt)return;if(r=E[a],i=dt.find(a),i.size()){r.listen&&(G[a]=i.eq(0));try{n=f(K,U,r,i),n==U&&e[a]!=U&&void 0!==n&&f(K,e[a],r,i)}catch(o){t("Transient fail linking "+a+" of form $('.my-form-"+N+"')",o.message,o.stack)}try{n!=U&&u(i,n),i.eq(0).trigger("check.my")}catch(o){x("Error linking "+a,o.message,o.stack)}}}dt.removeClass(ot),ut=null,et.resolve(K)}function x(e,r){var n;if(tt=!0,t("Form "+C+" failed to initialize",e,r),dt.removeClass(ot),n=nt(e,r),Y(n)||Z(n)&&n.jquery?dt.html(n):n===!0&&dt.html(ut),R.silent)et.resolve(K);else{if(!dt.my().ddata){if(dt.removeData("my"),dt.removeClass("my-form"),B)if("1"==B.data("count"))try{B.remove()}catch(i){}else B.data("count",B.data("count")-1);if(Q)try{delete $[N],Q.remove()}catch(i){}}et.reject("Form "+C+" failed to initialize: "+e,r)}}var k,O,C,N,S,T,E,R,P,F,L,A,H,B,Q,W,V={},K={},X=[],G={},et=e.Deferred(),tt=!1,nt=function(){},ot="my-form-init",ct="std",ut="";if(Y(i)){if(k=at(i),!k)return et.reject("No manifest with id "+i+" found in repo."),et.promise();Z(o)&&Z(a)?(k=I(k,a),O=o):O=a,ct="repo"}else k=i,O=a;if(!k)return this;P=Z(O)&&"repo"!=ct?I(!0,{},k):k;var dt=this.eq(0),ft=dt.my();return Z(ft)&&ft.id&&ft.ui?(r("jQuery.my is already bind.",dt),dt.my("ui",P.ui),dt.my(J,P.data),et.resolve(dt.my(J)).promise()):(R=P.params||{},R.strict||(R=I(!0,{},R),j(R)),R=I(!0,{},st.params,R),et.fail(function(){dt.removeClass(H+" "+A)}),I(dt,et.promise()),Z(O)?(K=lt.patch(O,P.data||{}),P.data=K):K=P.data||{},V.data=K,dt.data("my",{data:K,params:R,promise:et.promise(),locktill:0}),dt.addClass(ot),P.inherit&&c(P),lt.require(P,R).then(function(){m(),p().then(function(){h(),y()})}).fail(function(e){m(),x("Linker of ‘require’ property failed.",e)}),et.then(d),dt)},redraw:function(e,t){var r=this,n=r.my();return n&&n.ui&&(n.ui.each(function(t){var i=r.find(t);y(i,e?U:void 0,n.params.recalcDepth),e||(i.is(".my-form")&&i.my("redraw"),i.trigger(i.is(".my-form-list")?"redraw":"check.my"))}),!t&&e&&r.trigger(V)),r},data:function(e,t){var r=this;return Z(e)&&(r.my().data=lt.overlap(r.my().data,e),this.my("redraw",t)),r.my().data},errors:function(){var t=e(this).my().errors,r={};for(var n in t)t[n]&&Y(t[n])&&(r[n]=t[n]),Z(t[n])&&nt(t[n]).length&&(r[n]=t[n]);return r},valid:function(){var t=e(this).my().errors,r=0;for(var n in t)t[n]&&Y(t[n])?r++:Z(t[n])&&nt(t[n]).length&&r++;return!r},reset:function(){try{lt.kickoff(this.my().data,this.my().initial),this.my("redraw")}catch(e){return!1}return!0},id:function(e,t){if(Y(e))return at(e,t);var r=this.my();return r&&r.id?r.id:U},remove:function(e){var t,r,n,i,a,o,s,l,c=this;if(!this.my())return U;if(this.my().root&&!this.my().ddata&&(c=this.my().root),n=c.my(),a=n.data,s=n.cid,l=n.mid,c.unbind(".my"),Z(n)&&n.manifest&&rt(n.manifest.die))try{n.manifest.die.call(n.manifest,c,n.manifest)}catch(u){}if(t=n.style)if("1"==t.data("count"))try{t.remove()}catch(u){}else t.data("count",t.data("count")-1);if(r=n.localStyle)try{delete $[s],r.remove()}catch(u){}if(window.URL&&(i=n.locFiles)&&i.length)for(var f=0;f<i.length;f++)try{URL.revokeObjectURL(i[f])}catch(u){}if(o=(n||{}).ui,o&&o.each(function(e){var t,r,n,i=c.find(e);if((r=i.data("modal"))&&(r.cancel(),i.removeData("modal")),r=i.data("modals"))for(n in r)r[n]&&r[n].cancel();i.unbind(".my");try{t=d(i,st.destroy),rt(t)&&t(i)}catch(a){}i.removeData("formlist").removeData("myval").removeData("my")}),e&&c.is(".my-form"))c.remove();else if(c.data("formlist")&&c.is(".my-form")){var m=c.parents(".my-form-list").eq(0);c.remove(),m.trigger("check")}else c.removeData("formlist").removeData("myval").removeData("my").removeClass("my-form");return c.removeClass("my-form-"+s+" my-manifest-"+l),a},undo:function(e){var t,r=this,n=r.my(),i=n.params.history,a=nt(i).sort(),o=1*(parseInt(e)||0);return!a.length||0>o?U:(n.params.errors&&n.params.errors.values().compact(!0).length?Object.equal(n.data,n.lastCorrect)||(o+=1):Object.equal(i[a.last()],n.data)&&(o+=1),t=v(o,n.params,!0),t&&(lt.kickoff(r.my().data,t),r.my("redraw")),r.my().data)},ui:function(e){var t,r=this,n=r.my(),i=[];if(!n)return U;I(!0,{},n.ui);if(!Z(e))return n.ui;for(t in e)i.push(t);for(n.ui=q(lt.overlap(n.ui,e)),t=0;t<i.length;t++)g(r.find(i[t]),r,n.ui[i[t]],i[t]);for(t in e)r.find(t).eq(0).trigger("check");return n.ui},disabled:function(e){var t,r,n,i,a=this,o=a.my();if(!o)return void 0;if(e==U)return o.disabled;if(e){for(r in o.ui)t=a.find(r).eq(0),n=t.my(),n&&(n.predisabled=n.disabled),p(!0,t,":disabled");a.addClass("my-disabled")}else{for(r in o.ui)t=a.find(r).eq(0),n=t.my(),i=!1,n&&n.predisabled&&(i=!0),p(i,t,":disabled");a.removeClass("my-disabled"),a.my("redraw")}},find:function(e){var t=this,r=t.my();return r&&r.root&&(t=r.root),t.find(e)},radio:function(e,t){this.trigger("radio",Y(e)?{channel:e,message:t}:e)},manifest:function(e){return"json"==e?lt.tojson(this.my().manifest):this.my().manifest},version:function(){return T},history:function(e,t){return v(e,this.my().params,t)},val:function(e){return u(this,e)},container:function(e){return d(e,st.containers)(e)},promise:function(e){return rt(e)&&this.my().promise.then(e),this.my().promise},index:function(){var e=this.my().root&&!this.my().ddata?this.my().root:this;return(e.data("formlist")||{}).index},insert:function(e,t){var r,i,a=this.is(".my-form-list")?this:this.my().root||this,o=a.is(".my-form-list")?a:a.parent(".my-form-list"),s=(a.data("formlist")||{}).index,l=t;if(null==s&&(s=0),r=n(o.my().data,o.data("formlist").generator.bind),!Z(l))if(Z(o.data("formlist").generator.manifest))l=Object.clone(o.data("formlist").generator.manifest.data,!0)||{};else{if(o===a)throw"No data to insert, cannot guess when manifest is function.";l=Object.clone(a.my().manifest.data,!0)}if("before"===e)i=s;else if("after"===e)i=s+1;else{if(isNaN(e))throw"Invalid position for insert";i=(1*e).clamp(0,r.length)}r.add(l,i),o.trigger("redraw")}};e.my||(e.my={}),e.extend(e.my,{f:e.extend({},lt),tojson:lt.tojson,fromjson:lt.fromjson,radio:function(t,r){l(e(document),Y(t)?{channel:t,message:r}:t)},rules:st,cache:function(e,t){return rt(e)?at=e:at(e,t)},version:function(){return T},ajax:function(e){return rt(e)?ot=e:ot.apply(this,Array.prototype.slice.call(arguments))}}),e.my.chain=function(){function e(){if(n.length&&i){var t,r=n.shift(),a=function(){e.delay(r[1])}.once();try{t=r[0]()}catch(o){a()}it(t)?(t.then(a,a),a.delay(r[1])):a()}}var t=1,r=1e3,n=[],i=!1,a=function(i,a,o){n.push([i,a||t,o||r]),e()};return a.delay=function(e){return isNaN(e)||(t=(e-0).clamp(0,1e6)),t},a.timeout=function(e){return isNaN(e)||(r=(e-0).clamp(1,1e6)),r},a.start=function(){i=!0,e()},a.stop=function(){i=!1},a}(),e.fn.my=function(t){var r;if(void 0===t)return this.data("my");if(Y(t)&&"{"==t.substr(0,1)){try{r=JSON.parse(t)}catch(n){}if(r)return ct.init.apply(this,[r].add(Array.prototype.slice.call(arguments,1)))}return Y(t)&&ct[t]?ct[t].apply(this,Array.prototype.slice.call(arguments,1)):Y(t)&&at(t,"exist")?ct.init.apply(this,arguments):typeof t!==H&&t?void e.error("Method "+t+" does not exist on jQuery.my"):ct.init.apply(this,arguments)},e(window).off(".my").on("radio.my",function(t,r){t.stopPropagation(),l(e(document),r)}).on("resize.my",function(){for(var e in $)try{$[e]()}catch(t){}}.debounce(100))}(jQuery),function(e){function t(e,t,r){if(l(t))return e+t;if(c(t))return r=i(!0,r,t),e;if(s(t)&&t.length>1&&l(t[1])){for(var n,u,f,m,h,p,y,v,g=t[0],b="",x=1;x<t.length;){if(l(t[x]))if(m=t[x].replace(/\s/g,""),f=m.split(/[\.#]/i),u=r.alias[f[0]]||f[0],n=m.substr(f[0].length),/^[a-z0-9]+(#[a-z0-9\-_]+)?(\.[a-z0-9\-_]+)*$/i.test(m)){y=d.tmpl[u]||d.tmpl[""],p={style:"","class":"",txt:""},v="";var w=c(t[x+1]);if(w){x+=1;for(h in t[x])""!==d.attnames[h]&&(p[d.attnames[h]||h]=t[x][h])}p.style||p["class"]||!r.styles[u]||(p.style=r.styles[u]),p.id||"#"!=n.to(1)||(p.id=n.from(1).split(".")[0]),!p["class"]&&/\./.test(n)&&(p["class"]=("#"==n.to(1)?n.substr(p.id.length+1):n).split(".").compact(!0).join(" "));for(h in p)v+=h+'="'+p[h]+'" ';if(w)for(h in t[x])""===d.attnames[h]&&(p[h]=t[x][h]);p.ext=v,!p.txt&&d.txt[u]&&(p.txt=d.txt[u](p)),p._tag=u,b+=typeof y==o?y(p)||"":typeof y==a?y.assign(p):""}else b+=t[x];x+=1}return b&&(b="<"+r.rowTag+' class="'+r.rowCss+'" '+(r.row?'style="width:'+r.row+"; ":"")+(r.label&&g?"padding-left:"+r.label+"; ":"")+'">'+(g?"<"+r.labelTag+' class="'+r.labelCss+'" '+(r.label?'style="display:inline-block;width:'+r.label+";margin-left:-"+r.label+'" ':"")+">"+g+"</"+r.labelTag+">":"")+b+"</"+r.rowTag+">"),e+b}return e}function r(e){var t=e;if(l(t)&&(t=t.split(/[\s,]/).compact(!0)),s(t)){for(var r={},n=0;n<t.length;n++){var i=t[n];if(c(i)){var a=Object.keys(i);1==a.length?r[a[0]]=i[a[0]]+"":r[i.id||i.key||i.name||""]=i.text||i.value||i.title||""}else r[i]=i+""}t=r}return c(t)?t:{}}function n(r,n){var a={};return s(r)?(i(!0,a,d.params,n||{}),r.length?r.reduce(t.fill(void 0,void 0,a),""):""):c(r)?void e.extend(d,r):""}var i=e.extend,a="string",o="function",s=Object.isArray,l=(Object.isBoolean,Object.isString),c=Object.isObject,u=(Object.isNumber,Object.isRegExp,Object.isFunction,'<input type="'),d={tmpl:{num:u+'number" {ext}/>',inp:u+'text" {ext}/>',sli:u+'range" {ext}/>',dat:u+'date" {ext}/>',btn:u+'button" {ext}/>',but:"<button {ext}>{txt}</button>",div:"<div {ext}>{txt}</div>",spn:"<span {ext}>{txt}</span>",sel:"<select {ext}>{txt}</select>",mul:'<select {ext} multiple="multiple">{txt}</select>',txt:"<textarea {ext}>{txt}</textarea>",err:' <span class="my-error-tip {class}" style="{style}">{txt}</span>',msg:'<div class="my-error-tip {class}" style="{style}">{txt}</div>',val:function(e){if(!s(e.vals))return"";var t=i({style:"",css:""},e);return t.txt=e.vals.reduce(function(e,t){return e+"<span class=\"my-shortcut\" onclick=\"$(this).parents('.my-row').find('input,textarea').val($(this).text()).trigger('blur')\">"+t+"</span> "}," "),'<span class="my-shortcuts {css}" style="{style}">{txt}</span>'.assign(t)},"":"<{_tag} {ext}>{txt}</{_tag}>"},txt:{sel:function(e){if(!e.vals)return"";var t=r(e.vals);return Object.keys(t).reduce(function(e,r){return e+'<option value="'+r+'">'+t[r]+"</option>"},"")}},params:{styles:{num:"width:30%;",dat:"width:30%;",inp:"width:100%",but:"width:30%",txt:"width:100%;max-width:100%;min-height:1px;word-break:break-word;",err:"display:none",msg:"display:none"},alias:{number:"num",date:"dat",slider:"sli",textarea:"txt",input:"inp",span:"spn",select:"select",vals:"val"},row:"",rowTag:"div",rowCss:"my-row",label:"",labelTag:"span",labelCss:"my-label"},defaults:{id:"","class":"",style:"",placeholder:"",value:"",rows:1},attnames:{css:"class",plc:"placeholder",val:"value",txt:"",vals:"",tip:"title"}},f={init:function(t,r){return e(this).html(n(t,r))}};e.my||(e.my={}),e.my.formgen=n,e.fn.formgen=function(t){return l(t)&&f[t]?f[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.formgen"):f.init.apply(this,arguments)}}(jQuery),function(e){function t(t,r,n,i){var a,s,l,d,f,m,h;if("object"==typeof r&&r.jquery)r.is("img")&&(m=r,f=r.attr("alt")||r.attr("title")||r.data("text")||"",s=m[0].naturalWidth||m[0].width,a=m[0].naturalHeight||m[0].height,1>a&&(a=1),1>s&&(s=1),d=e(window).width()-90,l=e(window).height()-90,a>l&&(s=s*(l/a)|0,a=l),s>d&&(s=d,a=a*(d/s)|0),h=300>s?300:s,o(t,{source:"image",manifest:{init:function(e){e.html(this.HTML),e.on("click.my","img:eq(0)",function(){e.trigger("cancel")})},HTML:'<img src="" class="db" style="max-width:'+s+"px;max-height:"+a+'px"><h4 class="mt10"></h4>',ui:{"img:eq(0)":"img",h4:{bind:"text",css:{hide:function(e,t){return!t}}}}},data:{img:m.attr("src"),text:f},esc:!0,screen:!0,width:i||h,focus:!1,global:!0,z:"1995"},n));else if(u(r)&&r.manifest)o(t,r,n);else{if(!c(r))return null;o(t,{source:"html",manifest:{init:function(e){e.html(this.HTML)},HTML:r,ui:{"div:eq(0)":function(){}}},data:{},esc:!0,focus:!1,width:i},n)}return t}var r,n={},i="body",a=!1,o=e.extend,s={},l=(Object.isArray,Object.isBoolean),c=Object.isString,u=Object.isObject,d=Object.isNumber,f=(Object.isRegExp,Object.isFunction);e(document).keydown(function(e){var t,r,n=e.keyCode;if(!1!==a&&(13===n||27===n)){if(r=a.data("modal"),t=r.form,27==n&&(r.esc||Object.equal(t.data("my").initial,t.my("data"))))return a.modal(!0),!1;if(13==n&&r.enter)return function(e){e.modal()}.fill(a).delay(50),!1}}),n.modal=function(r,n,o){var s,c={},u=e(i),d=u.find(">.my-modal-proxy"),m={global:!0,screen:!0,done:f(n)?n:void 0,z:"1995"};return l(r)||null==r?d.modal(r):(s=e.Deferred(),t(c,r,m,o)?a?s.reject("Locked").promise():(d.size()||(d=e('<div class="my-modal-proxy"></div>').prependTo(u),d.css({position:"absolute",top:"0",left:"0",margin:"0",padding:"0",width:"1px",height:"0"})),d.modal(c)):s.reject("Invalid data").promise())},n.modal.loading=function(t){e(i).find(">.my-modal").toggleClass("my-modal-loading",!!t)},n.modal.parent=function(t){return t&&e(t).size()?void(i=t):e(i)},n.modal.parentBack=function(t){return t&&e(t).size()?void(r=t):e(r||i)},n.modal.visible=function(){return!!a},e.my||(e.my={}),e.my.modal=n.modal,e.fn.modal=function(n,m,h){function p(){var t,r,n=window,i=!!M.global,a=w.offset(),o=D.offset();M.pos={px:a.left,py:a.top,pw:w.outerWidth(),ph:w.outerHeight(),ox:o.left,oy:o.top,ow:D.outerWidth(),oh:D.outerHeight(),ww:r,wh:t};var s=1*(M.x.match(/\-?\d+(\.\d+)?/)||[0])[0],l=1*(M.y.match(/\-?\d+(\.\d+)?/)||[0])[0],c=M.x.has("left")?-1:M.x.has("right")?1:0,u=M.y.has("top")?-1:M.y.has("bottom")?1:0,f=M.pos.ox+M.pos.ow/2-M.pos.px,m=M.pos.oy+M.pos.oh/2-M.pos.py;if(i&&(M.pos.wh=t=n.innerHeight||e(n).height(),M.pos.ww=r=n.innerWidth||e(n).width(),f=r/2,m=t/2.5),s=M.x.has("%")?M.pos.ow/100*s:s,l=M.y.has("%")?M.pos.oh/100*l:l,M.pos.pix=f,M.pos.piy=m,f=f+c*(M.pos.ow/2)+s*(c>0?-1:1)-(M.width+_)*(c+1)/2,i?(m=(t-M.height-20)/3,10>m&&(m=10)):m=m+u*(M.pos.oh/2)+l*(u>0?-1:1)-(M.height||0)*(u+1)/2,f=f.round(1),m=m.round(1),M.pos.vx=f,M.pos.vy=m,M.bound!==!1&&!M.global){var h=(d(M.bound)?M.bound:0).clamp(-100,100);M.pos.pw-2*h<M.width+_?M.pos.vx=-(M.width+_-M.pos.pw)/2:M.pos.vx+M.width+_>M.pos.pw-h?M.pos.vx=M.pos.pw-h-M.width-_:M.pos.vx<h&&(M.pos.vx=h),M.pos.ph-2*h<M.height?(M.pos.vy=h,M.height=M.pos.ph-2*h):M.pos.vy+M.height>M.pos.ph-h?M.pos.vy=M.pos.ph-h-M.height:M.pos.vy<h&&(M.pos.vy=h)}}function y(t){if(t||(M.height=b.outerHeight(),"manifest"!==M.source&&(M.width=b.width()),p()),b.css({width:M.width+_+"px",display:"block"}),M.global)b.css({left:"50%","margin-left":"-"+((M.width+_)/2).round(0)+"px"});else if(b.css({left:M.pos.vx+"px"}),M.nose){e("style#my-modal-style-"+M.cid).size()||b.append('<style id="my-modal-style-'+M.cid+'"></style>');var r="",n=e("style#my-modal-style-"+M.cid);("top"==M.nose||"bottom"==M.nose)&&(r+="div.my-modal-"+M.cid+".nose-"+M.nose+":before {left:"+(M.pos.ox-M.pos.px+M.pos.ow/2-M.pos.vx)+"px!important;}",n.text(r)),("left"==M.nose||"right"==M.nose)&&(r+="div.my-modal-"+M.cid+".nose-"+M.nose+":before {top:"+(M.pos.oy-M.pos.py+M.pos.oh/2-M.pos.vy)+"px!important;}",n.text(r))}M.screen?M.global?(j.css({top:0,left:0,width:2*M.pos.ww+"px",height:2*M.pos.wh+"px",display:"block",position:"fixed","z-index":M.z-1}),c(M.screen)&&j.css({background:M.screen?M.screen:"rgba(30,65,100,0.8)"})):j.css({top:0,left:0,position:"absolute",width:M.pos.pw+"px",height:M.pos.ph+"px",display:"block",background:c(M.screen)?M.screen:"rgba(40,80,120,0.5)","z-index":M.z-1}):j.size()&&j.hide(),M.height>M.pos.wh?(b.height(M.pos.wh-30),x.css({"overflow-y":e.browser.webkit?"overlay":"scroll"})):x.css({"overflow-y":"none"}),b.animate({top:M.pos.vy+"px",opacity:"1"},M.animate)}function v(){try{x.my("remove")}catch(t){}try{w.data("modals")[M.cid]=null}catch(t){}x.parent().unbind(".my").remove(),j.off(".my"+M.cid),M.screen&&function(e){e&&a||j.hide(),e&&!a&&j.css({background:"rgba(30,65,100,0.8)"})}.delay(50,M.global),M.global&&(a=!1,e("body").css({overflow:"auto"}))}function g(e){try{S(null,null)}catch(t){}(function(){q.reject(e)}).delay(0)}var b,x,w,j,k,O,C,q=e.Deferred(),z={},D=this,_=0,N=0,S=f(m)?m:function(){return!1},T=u(n)?n:{},M=D.data("modal");if(o(D,q.promise()),M){if(null==n||l(n)){if(x=M.form,j=M.bg,w=M.root,S=M.done,O=x.my("data"),C=!1,n){try{S(null,null)}catch(E){}if(v(),D.removeData("modal"),s[M.cid])try{s[M.cid].reject("Cancelled")}catch(E){}delete s[M.cid],M=null}else{try{C=S(x.my("valid")?null:x.my("errors"),O)}catch(E){}C||(v(),D.removeData("modal"),function(){s[M.cid]&&s[M.cid].resolve(O),delete s[M.cid],M=null}.delay(0))}return D}if(T)return g("Locked"),D}return D.is(":visible")?(T=t(z,n,{}))?T.global&&a?(g("Locked"),D):(M=o({type:"DOM",source:"manifest",form:null,modal:null,root:null,bgroot:null,caller:D,manifest:{},data:{},global:!1,screen:!1,drag:!1,focus:!0,close:!0,silent:!0,esc:!1,enter:!1,bound:!1,nose:"",width:h||300,height:null,x:"0",y:"0",z:"1901",background:"white",css:"",animate:200},T,{promise:q.promise(),cid:Number.random(268435456,4294967295).toString(16)}),M.done=f(M.done)?M.done:S,c(M.align)&&M.align&&(M.x=(M.align.match(/(left|right):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0],M.y=(M.align.match(/(top|bottom):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0]),M.width=1*(e.my.f.getref(c(M.manifest)?e.my.cache(M.manifest):M.manifest,"params.width")||M.width),M.type="DOM",D.hasClass("my-form")?(M.type="form",M.root=M.root||D):D.data("my")?(M.type="control",M.root=M.root||D.my().root):(M.root=M.root||D.parents(".my-form").eq(0),M.root.size()||(M.root=e(i))),M.global?(M.root=e(i),M.bgroot=e(r||i)):M.bgroot=M.root,w=M.root,w.data("modals")||w.data("modals",{}),p(),b=e('<div class="my-modal my-modal-'+(M.global?"fullscreen ":"overlay ")+M.css+(M.nose?" nose-"+M.nose:"")+'"></div>').prependTo(M.root),b.addClass("my-modal-"+M.cid),_=b.outerWidth(),N=b.outerHeight(),b.hide(),b.html('<div class="my-modal-form"></div>'),x=b.find(".my-modal-form"),M.close&&(k=e(c(M.close)?M.close:'<div class="my-modal-close" title="Close">×</div>').prependTo(b).on("click.my",function(){D.modal(!0)}),k.css({"z-index":("+"===(M.z+"").to(1)?"+":"")+(1*M.z+1)})),j=M.bgroot.find(">.my-modal-screen"),M.screen&&(j.size()||(j=e('<div class="my-modal-screen" style="display:none;"></div>').prependTo(M.root)),M.esc&&j.on("click.my"+M.cid,function(){D.modal(!0)})),D.data("modal",M),M.silent&&b.on("change.my",function(){return!1}),b.css({display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto"}),b.css(M.global?{position:"fixed",left:"50%",top:M.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto","margin-left":"-"+((M.width+_)/2).round(0)+"px"}:{position:"absolute",left:M.pos.vx+"px",top:M.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto"}),x.my(M.manifest,M.data).then(function(){var t,r,n,i,l;if(o(M,{form:x,bg:j,cancel:function(){D.modal(!0)},commit:function(){D.modal()}}),b.data("modal",M),M.height=b.outerHeight(),"manifest"!==M.source&&(M.width=b.width()),p(),b.css({top:M.pos.vy+"px"}),y(!0),w.data("modals")[M.cid]=M,s[M.cid]=q,x.bind("commit.my",function(){return M.commit.delay(50),!1}).bind("cancel.my",function(){return M.cancel.delay(50),!1}),b.bind("layout.my",function(){y()}.debounce(50)),M.global&&(a=D,e("body").css({overflow:"hidden"})),M.global||!M.esc&&!M.enter||x.bind("keydown.my",function(t){var r=t.keyCode;return 27==r&&M.esc?(M.cancel(),!1):13==r&&M.enter&&!e(t.target).is("textarea")?(M.commit.delay(50),!1):void 0}),M.focus===!0){i=!1,l=M.manifest.ui;for(n in l)i||(r=x.find(n),r.size()&&r.is("input, textarea")&&(i=!0,r.focus()))}else c(M.focus)&&x.find(M.focus).focus();if(t=x.find("img").filter(function(){return""!=e(this).attr("src")}),t.size()){var u=function(){"manifest"!==M.source&&b.css({width:"auto"}),y()}.after(t.size());t.each(function(){e(this).bind("load",u)})}M.drag&&e.fn.draggable&&(c(M.drag)?b.draggable({handle:M.drag}):b.draggable()),q.notify("Ready")}).fail(function(e){v(),D.data("modal",null),q.reject(e)}),D):(g("Invalid data"),D):(g("Object must be visible"),D)}}(jQuery);
